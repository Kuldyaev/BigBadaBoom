<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>BigBadaBoom!!!</title>
	<link rel="shortcut icon" type="image/jpeg" href="data:image/jpeg;base64,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"/>
	<style>
		.oldclass { color: black }
		.newclass { color: red }
		#layer1, #layer2, #layer3, #layer4 { position:absolute;}
		#layer1 {  z-index: 1; height:100%;}
		#layer2{z-index: 2; height: 100%;}
		#layer3 { z-index: 3; width: 100%; height: 100%;}
		#layer4{ 
			z-index: 4; 
			width: 53%; 
			height: 600px; 
			margin-top: 20px; 
			margin-left: 25%; 
			text-align: center;
			background-color: #708090;
			opacity: 0.95;
		}	
		#finish{height: 50px; width: 25%; flex: left;}
		#finish{height: 50px; width: 75%; flex: right;}
		#cdeck{height: 78%;}
		#restart{ height: 30%;}
		#decks{height: 100%;}
		#fon{
		  width: 100%;
		  height: 100%;
		  background-color: black;
		  opacity: 0.2;
		}
		#firstPopTitle{height: 10%; width: 100%;}
		#firstPopText{height: 65%; width: 100%;}
		#firstPopButton{height: 25%; width: 100%;}
				
	</style>
</head>

<body style="background: #e9e9e9;">
    <script type="text/javascript">
	
	const Player = function(x) {
	  this.x = x;
	};
	
	Player.prototype.render = function() {
		ctx.clearRect(0, 0, 640, 512);
		ctx.beginPath();
		ctx.moveTo(this.x,50);
		ctx.lineTo(this.x-8,0);
		ctx.lineTo(this.x+8,0);
		ctx.fillStyle = 'black';
		ctx.fill();
	};
	
	Player.prototype.handleInput = function (keyPress) {
		if (keyPress === 'left' && this.x >15) {
			this.x -= 10;
		};
		if (keyPress === 'right' && this.x < 625) {
			this.x += 10;
		};
	};	
	
	const player = new Player(300);
	
	const Enemy = function (x, y, radius, color, speed) {
		this.x = x;
		this.y = y;
		this.speed = speed;
		this.color = color;
		this.radius = radius;
    };
	
	Enemy.prototype.render = function() {
		ctx.beginPath();
		ctx.arc(this.x,this.y,this.radius,0,Math.PI*2,true); 
		ctx.fillStyle = this.color;
		ctx.fill();
    };
	var score = [0,0];
	
	Enemy.prototype.update = function(dt, wind, gt) {
		this.y -= this.speed * dt + 0.01*gt;
		
		if((this.x-this.radius)>0 && (this.x+this.radius)<640){
			if(wind>3){this.x += ((wind-3)/10)*(1-this.x/650);}
			if(wind<3){this.x += ((wind-3)/10)*(this.x/650);}
			
		}
		else {
			if((this.x-this.radius)<=0 && wind>3){this.x += ((wind-3)/10)*(1-this.x/650);}
			if((this.x-this.radius)>=640 && wind<3){this.x += (((wind-3)/10)*(this.x/650));}
		}
		
		if ((Math.sqrt(Math.pow(this.x-player.x, 2)+Math.pow(this.y-50, 2)))<=this.radius) {
			score[0]+=1;
			this.radius = 20+ Math.floor(Math.random() * 20);
			this.x = this.radius + Math.floor(Math.random() * (620 - 2*this.radius));
			this.y = 515 + this.radius;
			this.speed =  20 + Math.floor(Math.random() * 20  + 0.3*gt);
		};
		
		if ( -this.y > this.radius){
			score[1]+=1;
			this.radius = 20+ Math.floor(Math.random() * 20);
			this.x = this.radius + Math.floor(Math.random() * (620 - 2*this.radius));
			this.y = 515 + this.radius;
			this.speed =  25 + Math.floor(Math.random() * 20 + 0.1*gt );
		}
	};

	
	const allEnemies = [];

	const enemyData = [
			[63, 463, 52, 'blue', 27],
			[125, 250, 100, 'red', 38],
			[452, 170, 30, 'yellow', 45],
			[512, 400, 35, 'green', 23],
			[352, 425, 25, 'white', 33],
			[452, 600, 25, 'teal', 30],
			[500, 555, 25, 'aqua', 40],
			[102, 625, 25, 'lime', 35],
			[392, 650, 25, 'fuchsia', 23],
	];
	enemyData.forEach(function (X) {
		enemy = new Enemy(X[0], X[1], X[2],  X[3], X[4]);
		allEnemies.push(enemy);
	});
	document.addEventListener('keydown', function(e) {
		const allowedKeys = {
			37: 'left',
			39: 'right',
		};
		player.handleInput(allowedKeys[e.keyCode]);
	});
		
	
	var Engine = (function(global) {
			var doc = global.document,
				win = global.window,
				canvas = doc.createElement('canvas'),
				divTop = doc.createElement('div'),
				divTopLeft = doc.createElement('div'),
				divTopCenter = doc.createElement('div'),
				divTopRight = doc.createElement('div'),
				divMain = doc.createElement('div'),
				gameTitle = doc.createElement('h2'),
				divBottom = doc.createElement('div'),
				butReset = doc.createElement('button'),
			
				ctx = canvas.getContext('2d'),
				lastTime, 
				startTime;
				finalCountdown = false;
				lastWindTime = 0;
				
				var initData = [
							["Time","Catch","Lost","Wind"],
							[60,0,0,3]
						];
						
				const windSymbols = ['\u25c4\u25c4\u25c4','\u25c4\u25c4','\u25c4','\u25b2','\u25b6','\u25b6\u25b6','\u25b6\u25b6\u25b6'	];		
						
				const startText = [
					"Снизу в верх с разной скоростью поднимаются шары разного размера и цвета.",
					"Сверху иголка, которую игрок может двигать в левую или правую сторону.",
					"Если кончик иголки упирается в поднимающийся шар, то шар лопается и засчитывается в текущий счёт.",
					"Так же есть обратный таймер в 1 минуту. Это время за которое необходимо лопнуть максимальное количество шаров.",
					"Постепенно шаров должно становиться больше и скорость их взлёта должна увеличиваться.",
					"На шары произвольно может воздействовать ветер с левой или с правой стороны сдвигая поднимающиеся шары.",
					"Чем дальше шар от стороны с которой дует ветер тем меньше на него воздействие. Так же шары не могут улетать за левую или правую границы.",
					"После окончания таймера все текущие шары должны улететь за верхнюю границу экрана и после этого необходимо",
					"показать количество пропущенных и лопнувших шаров."
				];		
				marginGlobal = String((document.documentElement.clientWidth - 640)/2) + 'px';
				
				
			divMain.className = 'main';
			divMain.id = 'layer1';
			divTop.className = 'header';
			divBottom.className = 'bottom';
			canvas.className = 'canvas';

			
			divMain.style.width = '640px';
			divMain.style.height = '640px';
			divMain.style.marginLeft = marginGlobal;
			divMain.style.marginTop = '10px';
			divMain.style.border = '4px double black';
			
			divTop.style.width = '640px';
			divTop.style.height = '64px';
			divTop.style.backgroundColor = 'silver';
			divTop.style.display = 'flex';			
			divTop.appendChild(divTopLeft);
			divTop.appendChild(divTopCenter);
			divTop.appendChild(divTopRight);
			
			divTopLeft.style.width = '200px';
			divTopLeft.style.height = '64px';
			divTopCenter.style.width = '240px';
			divTopCenter.style.height = '64px';
			divTopRight.style.width = '200px';
			divTopRight.style.height = '64px';
			butReset.style.width = '160px';
			butReset.style.height = '40px';
			butReset.style.marginTop = '12px';
			butReset.textContent = 'Reset';
			
			
			divTopCenter.style.textAlign = 'center';
			divTopRight.style.textAlign = 'center';
			gameTitle.innerHTML="Big Bada Boom";
			gameTitle.style.color = 'black';
			gameTitle.style.margin = '0px';
			gameTitle.style.paddingTop = '15px';
			
			
			
			divBottom.style.width = '640px';
			divBottom.style.height = '64px';
			divBottom.style.backgroundColor = 'silver';
			divBottom.style.display = 'flex';
			divBottom.style.margin = '0px';
			divBottom.style.marginTop = '-4px';

			
			canvas.width = 640;
			canvas.height = 512;
			
			
			
			doc.body.appendChild(divMain);
			divMain.appendChild(divTop);
			divMain.appendChild(canvas);
			divMain.appendChild(divBottom);
			divTopCenter.appendChild(gameTitle);
			divTopRight.appendChild(butReset);
			
			canvas.style.background = "#848482";
			
			
			for (var i = 0; i < 4; i++) {
				const divBottomItem = doc.createElement('div'),
					divBottomItemTitle = doc.createElement('div'),
					divBottomItemValue = doc.createElement('div'),
					divBottomItemTitleText = doc.createElement('p'),
					divBottomItemValueText = doc.createElement('h3');
				divBottomItem.className = 'bottomItem';
				divBottomItem.style.width = '160px';
				divBottomItem.style.height = '64px';
				divBottomItemTitle.style.width = '160px';
				divBottomItemTitle.style.height = '24px';
				divBottomItemValue.style.width = '160px';
				divBottomItemValue.style.height = '40px';
				divBottomItemTitleText.style.margin = '0px';
				divBottomItemValueText.style.margin = '0px';
				divBottomItem.id = i ;
				divBottom.appendChild(divBottomItem);
				divBottomItem.appendChild(divBottomItemTitle);
				divBottomItem.appendChild(divBottomItemValue);
				divBottomItemTitle.appendChild(divBottomItemTitleText);
				divBottomItemTitleText.id = i+4 ;
				divBottomItemTitleText.textContent = initData[0][i];
				divBottomItemValue.appendChild(divBottomItemValueText);
				divBottomItemValueText.id = i+8 ;
				divBottomItemValueText.textContent = initData[1][i];
				divBottomItemTitle.style.textAlign = 'center';
				divBottomItemValue.style.textAlign = 'center';
				butReset.onclick = reset;
			}
			
		
   
		function main() {
			var now = Date.now(),
				dt = (now - lastTime) / 1000.0,
				gt = (now - startTime) /1000.0;

			update(dt, gt, initData[1][3]);
			render();
			lastTime = now;
			if ( ((now-startTime)/1000)<59 ){
					win.requestAnimationFrame(main);
			}else{finishPopUp()}
		}

  
		function init() {
			reset();
			startTime = Date.now();
			lastTime = Date.now();
			firstPopUp();
			document.getElementById(11).textContent = windSymbols[initData[1][3]];
		}

		function update(dt, gt, wind) {
			updateClock(gt);	
			updateWind(gt);
			updateScore();
			allEnemies.forEach(function(enemy) {
				enemy.update(dt, wind, gt);
			});
		}
		
		function render() {
			player.render();
			allEnemies.forEach(function(enemy) {
				enemy.render();
			});
		}
		
		
		function firstPopUp() {
			const fonbox =  document.createElement('div');
			fonbox.id = 'layer3';
			doc.body.appendChild(fonbox);
			const fon = document.createElement('div');
			fonbox.appendChild(fon);
			fon.id = 'fon';
			const popbox =  document.createElement('div');
			popbox.id = 'layer4';
			popbox.className = 'popup';
			doc.body.appendChild(popbox);
			const infoPopTitle = document.createElement('div');
			const infoPopText = document.createElement('div');
			const infoPopTitleContext = document.createElement('h3');
			const infoPopButton = document.createElement('div');
			infoPopTitle.id = 'firstPopTitle';
			infoPopText.id = 'firstPopText';
			infoPopButton.id = 'firstPopButton';
			popbox.appendChild(infoPopTitle);
			popbox.appendChild(infoPopText);
			popbox.appendChild(infoPopButton);
			infoPopTitle.appendChild(infoPopTitleContext);
			infoPopTitleContext.style.marginTop = '45px';
			infoPopTitleContext.textContent = "игра ЛОПНИ ШАРИКИ";
			
			
			for (var i = 0; i < 8; i++) {
				const infoPopTextContext = document.createElement('h5');
				infoPopTextContext.id = 10+i ;
				infoPopTextContext.className = 'instruction' ;
				infoPopTextContext.textContent = startText[i];
				infoPopTextContext.style.marginTop = '5px';
				infoPopTextContext.style.marginBottom = '5px';
				infoPopText.appendChild(infoPopTextContext);
			}
			
			const buttonStart = document.createElement('button');
			buttonStart.textContent = 'START';
			buttonStart.onclick = firstPopUpClose;
			infoPopButton.appendChild(buttonStart);
		}
		
		function firstPopUpClose() {
			const fonbox =  document.getElementById('layer3');
			const popbox =  document.getElementById('layer4');
			fonbox.remove();
			popbox.remove();
			reset();
			main();
		}
		
		function finishPopUp() {
			const fonbox =  document.createElement('div');
			fonbox.id = 'layer3';
			doc.body.appendChild(fonbox);
			const fon = document.createElement('div');
			fonbox.appendChild(fon);
			fon.id = 'fon';
			const popbox =  document.createElement('div');
			popbox.id = 'layer4';
			popbox.className = 'popup';
			doc.body.appendChild(popbox);
			const infoPopTitle = document.createElement('div');
			const infoPopText = document.createElement('div');
			const infoPopTitleContext = document.createElement('h3');
			const infoPopButton = document.createElement('div');
			infoPopTitle.id = 'firstPopTitle';
			infoPopText.id = 'firstPopText';
			infoPopButton.id = 'firstPopButton';
			popbox.appendChild(infoPopTitle);
			popbox.appendChild(infoPopText);
			popbox.appendChild(infoPopButton);
			infoPopTitle.appendChild(infoPopTitleContext);
			infoPopTitleContext.style.marginTop = '45px';
			infoPopTitleContext.textContent = "Поздравляем!";
			const infoPopTextContext = document.createElement('h5');
			infoPopTextContext.id = 11 ;
			var text111 = "Вы поймали " + score[0] + " шариков"
			infoPopTextContext.textContent = text111;
			infoPopTextContext.style.marginTop = '5px';
			infoPopTextContext.style.marginBottom = '5px';
			infoPopText.appendChild(infoPopTextContext);
			const infoPopTextContext2 = document.createElement('h5');
			infoPopTextContext2.id = 19 ;
			var text111 = "упустили " + score[1] + " шариков"
			infoPopTextContext2.textContent = text111;
			infoPopTextContext2.style.marginTop = '5px';
			infoPopTextContext2.style.marginBottom = '5px';
			infoPopText.appendChild(infoPopTextContext2);
			const buttonStart = document.createElement('button');
			buttonStart.textContent = 'RESTART';
			buttonStart.onclick = finishPopUpClose;
			infoPopButton.appendChild(buttonStart);
		}

		function finishPopUpClose() {
			const fonbox =  document.getElementById('layer3');
			const popbox =  document.getElementById('layer4');
			fonbox.remove();
			popbox.remove();
			reset();
			main();
		}
		
		function updateClock(gt) {
			if (gt >  (60 - initData[1][0])){
				if( gt != 60){initData[1][0] -= 1;}
				document.getElementById(8).textContent = initData[1][0];
				if( gt > 49 && !finalCountdown){
					finalCountdown = true;
					document.getElementById(8).className = 'newclass';
				}
			}
		}
		
		function updateWind(gt) {
			if (gt > 8   && (gt-lastWindTime)>2){
				var randomWind = Math.floor(Math.random() * 100);	
				if(randomWind < 51){ 
					if(initData[1][3]> 0){
						initData[1][3] -= 1;
						lastWindTime = gt;
						showWindChange();
					} else {lastWindTime+=1}
				}
				else {
					if(initData[1][3]< 6){
						initData[1][3] += 1;
						lastWindTime = gt;
						showWindChange();
					} else {lastWindTime+=1}
				}
			}
		}
		
		function showWindChange(){
			var windCurrentValue = document.getElementById(11).innerHTML;
			if (windCurrentValue != initData[1][3]){
				document.getElementById(11).textContent = windSymbols[initData[1][3]];
			}
		}

		function updateScore() {
			if(document.getElementById(9).innerHTML != score[0]){
				document.getElementById(9).textContent = score[0];
				initData[1][1]+=1;
			}
			if(document.getElementById(10).innerHTML != score[1]){
				document.getElementById(10).textContent = score[1];
				initData[1][2]+=1;
			}
		}

		function reset() {
			initData[1][0] = 60;
			initData[1][1] = 0;
			initData[1][2] = 0;
			initData[1][3] = 3;
			score[0] = 0;
			score[1] = 0;
			finalCountdown = false;
			document.getElementById(8).className = 'oldclass';
			startTime = Date.now();
			lastTime = Date.now();
			lastWindTime = 0;
			ctx.clearRect(0, 0, 640, 512);
		}

    global.ctx = ctx;
	
	init();

	})(this);
</script>
</body>
</html>
